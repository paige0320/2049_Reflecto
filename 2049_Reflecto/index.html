<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eterna Mirror Â· å–®å¼µæ—©å®‰åœ–ï¼ˆJS é™£åˆ—ï¼Œä¸ç”¨ fetchï¼‰</title>
<style>
  html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans","PingFang TC","Microsoft JhengHei",sans-serif; }
  #videoBg { position:fixed; inset:0; width:100%; height:100%; object-fit:cover; transform: scaleX(-1); z-index:0; background:#000; }
  header { position: fixed; top:0; left:0; right:0; z-index:2; text-align:center; padding:1.2vh 2vw 2vh;
    background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0)); pointer-events:none; }
  h1 { font-size: clamp(26px, 5.5vw, 56px); margin:.2em 0; text-shadow: 0 2px 18px rgba(0,0,0,.45); }
  .sub { opacity:.9; font-size: clamp(12px, 2.5vw, 16px); }
  .time { font-size: clamp(18px, 4vw, 36px); font-variant-numeric: tabular-nums; margin-top:.2em; }
  .side { position: fixed; top: 14vh; bottom: 6vh; width: 22vw; z-index:2;
    display:flex; flex-direction:column; gap: 1.2vh; padding: 0 1vw; pointer-events: none; }
  .left { left: 0; align-items: flex-start; }
  .right { right: 0; align-items: flex-end; }
  .card { width: 100%; max-width: 360px; pointer-events:auto; background: rgba(0,0,0,.45);
    border:1px solid rgba(255,255,255,.18); border-radius: 14px; padding: .8em 1em; backdrop-filter: blur(8px); }
  .title { font-size: clamp(16px,3.6vw,22px); opacity:.95; margin:0 0 .1em; }
  .val { font-size: clamp(16px,3.8vw,24px); font-variant-numeric: tabular-nums; opacity:.95; }
  .note { font-size: clamp(12px,2.6vw,16px); opacity:.8; }
  .tasks li { margin: .2em 0; font-size: clamp(14px,3.6vw,18px); opacity:.95; }
  .gm-card { flex:1; display:flex; }
  #gmWrap { display:flex; align-items:center; justify-content:center; width:100%; border-radius:14px;
    background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); padding:.4em; }
  #gmWrap img { max-width:100%; max-height:100%; border-radius:12px; object-fit:contain; }
  .floating { position: fixed; right: 2vw; bottom: 8vh; z-index:2; display:flex; gap:.6em; }
  .btn { background: rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.25); border-radius:12px; padding:.55em .85em; backdrop-filter: blur(8px); font-size: clamp(12px,2.8vw,14px); }
  @media (max-width: 1024px){ .side { width: 28vw; gap: 1vh; } }
  @media (max-width: 768px){ header { padding: .8vh 2vw 1.2vh; } .side { width: 34vw; top: 12vh; bottom: 8vh; } .title { font-size: clamp(14px,4vw,18px); } .val { font-size: clamp(14px,4.4vw,20px); } }
</style>
</head>
<body>
  <video id="videoBg" autoplay playsinline muted></video>
  <header>
    <h1>æ—©å®‰ï¼Œä»Šå¤©ä¹Ÿä¸€èµ·åŠ æ²¹</h1>
    <div class="sub" id="date"></div>
    <div class="time" id="time"></div>
  </header>

  <!-- å·¦å´ï¼šæœè—¥æé†’ / è¦ªå‹å•å€™ / æ—©å®‰åœ– -->
  <section class="side left">
    <div class="card">
      <div class="title">æœè—¥æé†’</div>
      <div class="val">æ—©ä¸Š A è—¥ 1 é¡†</div>
      <div class="note">09:00 è¨˜å¾—æœç”¨</div>
    </div>
    <div class="card">
      <div class="title">è¦ªå‹å•å€™</div>
      <div class="val">å­«å¥³ï¼šæ—©å®‰é˜¿å…¬ â¤ï¸</div>
    </div>
    <div class="gm-card">
      <div id="gmWrap">
        <img id="gmImg" src="" alt="æ—©å®‰åœ–">
      </div>
    </div>
  </section>

  <!-- å³å´ï¼šå¿ƒè·³ï¼ˆç½®é ‚ï¼‰ / è¡€å£“ï¼ˆå«é«”æº«å‰¯æ¨™ï¼‰ / ä»Šæ—¥ä»»å‹™ -->
  <section class="side right">
    <div class="card">
      <div class="title">å¿ƒè·³</div>
      <div class="val">72 bpm</div>
    </div>
    <div class="card">
      <div class="title">è¡€å£“</div>
      <div class="val">125 / 78</div>
      <div class="note">é«”æº« 36.6 Â°C</div>
    </div>
    <div class="card">
      <div class="title">ä»Šæ—¥ä»»å‹™</div>
      <ul id="taskList" class="tasks">
        <li>â€¢ å»é†«é™¢å¾©å¥ï¼ˆ10:00ï¼‰</li>
        <li>â€¢ åœ–æ›¸é¤¨æ›¸åˆ°æœŸï¼ˆä»Šå¤©æˆ–ç·šä¸ŠçºŒå€Ÿï¼‰</li>
        <li>â€¢ æ¸¬ä¸€æ¬¡è¡€å£“</li>
      </ul>
    </div>
  </section>

  <div class="floating">
    <button class="btn" onclick="speakToday()">ğŸ”Š èªéŸ³æ’­å ±</button>
    <button class="btn" onclick="flipCam()">ğŸ” åˆ‡æ›é¡é ­</button>
    <button class="btn" onclick="switchTorch()">ğŸ”¦ è¼”åŠ©ç‡ˆ</button>
  </div>

  <script>
    // æ™‚é–“
    function pad(n){return n<10? '0'+n : n}
    function tick(){
      const now = new Date();
      document.getElementById('date').textContent =
        now.toLocaleDateString('zh-TW',{year:'numeric',month:'long',day:'numeric',weekday:'long'});
      document.getElementById('time').textContent = pad(now.getHours()) + ':' + pad(now.getMinutes());
    }
    setInterval(tick, 1000); tick();

    // ä»»å‹™ï¼šå›ºå®šå…©é … + æ¯æ—¥å†æŠ½ 1 é …
    const fixedTasks = ['å»é†«é™¢å¾©å¥ï¼ˆ10:00ï¼‰','åœ–æ›¸é¤¨æ›¸åˆ°æœŸï¼ˆä»Šå¤©æˆ–ç·šä¸ŠçºŒå€Ÿï¼‰'];
    const pool = ['å–æ°´ 6 æ¯','ä¼¸å±• 10 åˆ†é˜','çœ‹çœ‹æ˜¨å¤©çš„ç…§ç‰‡ / ç•™è¨€','å»ç¤¾å€ä¸­åº­èµ°èµ° 5 åˆ†é˜','æ°´æœä¸€ä»½ï¼ˆé¦™è•‰/è˜‹æœï¼‰','æ‰“é›»è©±çµ¦æœ‹å‹å•å€™ 5 åˆ†é˜'];
    function pickTasks(){
      const seed = new Date().toDateString();
      let rnd = [...seed].reduce((a,c)=>a+c.charCodeAt(0),0);
      function rand(){ rnd = (rnd*9301 + 49297) % 233280; return rnd/233280; }
      const copy = pool.slice();
      const i = Math.floor(rand()*copy.length);
      const selected = copy.splice(i,1);
      document.getElementById('taskList').innerHTML = ['â€¢ '+fixedTasks[0],'â€¢ '+fixedTasks[1],'â€¢ '+selected[0]].map(t=>'<li>'+t+'</li>').join('');
    }
    pickTasks();

    // æ—©å®‰åœ–ï¼šJS é™£åˆ—ï¼ˆä¸ç”¨ fetchï¼‰ï¼Œæ¯æ¬¡é–‹å•Ÿéš¨æ©Ÿä¸€å¼µ
    const gmImages = [
      "images/goodmorning/1.jpg",
      "images/goodmorning/2.jpg",
      "images/goodmorning/3.jpg",
      "images/goodmorning/4.jpg",
      "images/goodmorning/5.jpg",
      "images/goodmorning/6.jpg",
      "images/goodmorning/7.jpg",
      "images/goodmorning/8.jpg",
      "images/goodmorning/9.jpg"
      // ä¹‹å¾Œæ–°å¢åœ–ç‰‡æ™‚ï¼ŒæŠŠæª”ååŠ åœ¨é€™è£¡ï¼Œä¾‹å¦‚ï¼š
      // ,"images/goodmorning/02.jpg","images/goodmorning/03.jpg"
    ];
    (function showRandomGM(){
      const idx = Math.floor(Math.random()*gmImages.length);
      document.getElementById('gmImg').src = gmImages[idx];
    })();

    // ç›¸æ©Ÿ
    let currentFacing = 'user', currentStream = null, trackForTorch = null;
    async function startCamera(){
      stopCamera();
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentFacing, width: { ideal: 1280 }, height: { ideal: 720 } },
          audio: false
        });
        currentStream = stream;
        const video = document.getElementById('videoBg');
        video.srcObject = stream;
        const [track] = stream.getVideoTracks();
        trackForTorch = track;
      } catch (e) { alert('ç„¡æ³•é–‹å•Ÿç›¸æ©Ÿï¼š' + e.message); }
    }
    function stopCamera(){ if (currentStream){ currentStream.getTracks().forEach(t=>t.stop()); currentStream=null; } trackForTorch=null; }
    async function flipCam(){ currentFacing = (currentFacing === 'user') ? 'environment' : 'user'; await startCamera(); }
    async function switchTorch(){
      try {
        if (!trackForTorch) return alert('è£ç½®ä¸æ”¯æ´æˆ–å°šæœªå•Ÿç”¨ç›¸æ©Ÿ');
        const capabilities = trackForTorch.getCapabilities?.();
        if (capabilities && 'torch' in capabilities) {
          const settings = trackForTorch.getSettings();
          await trackForTorch.applyConstraints({ advanced: [{ torch: !settings.torch }] });
        } else { alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´æ‰‹é›»ç­’æ§åˆ¶'); }
      } catch (e) { alert('åˆ‡æ›è¼”åŠ©ç‡ˆå¤±æ•—ï¼š' + e.message); }
    }
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia){ startCamera(); } else { alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´ç›¸æ©Ÿå­˜å–'); }
    window.addEventListener('beforeunload', stopCamera);
    
  // å˜—è©¦æŒ‘é¸ä¸­æ–‡ï¼ˆå°ç£å„ªå…ˆï¼‰
  function pickZhTWVoice() {
    const vs = speechSynthesis.getVoices();
    return vs.find(v => /zh(-|_)TW/i.test(v.lang))
        || vs.find(v => /zh/i.test(v.lang))
        || vs[0];
  }

  function speak(text) {
    if (!('speechSynthesis' in window)) { 
      alert('æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³æ’­å ±'); 
      return; 
    }
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1; u.pitch = 1; u.volume = 1;
    const v = pickZhTWVoice(); 
    if (v) u.voice = v;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }

  // è’é›†é é¢è³‡è¨Šä¸¦æ’­å ±
  function speakToday(){
    const date = document.getElementById('date')?.textContent || '';
    const heart = (document.getElementById('heartRate')?.textContent) || 'å¿ƒè·³ä¸ƒåäºŒ';
    const bp    = (document.getElementById('bloodPressure')?.textContent) || 'è¡€å£“ä¸€äºŒäº”æ¯”ä¸ƒå…«';
    const temp  = (document.getElementById('temperature')?.textContent) || 'é«”æº«ä¸‰åå…­é»å…­åº¦';
    const tasks = [...document.querySelectorAll('#taskList li')].map(li=>li.textContent.replace(/^â€¢\s*/,'')).join('ï¼›');
    const msg = `æ—©å®‰ï¼ä»Šå¤©æ˜¯ ${date}ã€‚${heart}ï¼Œ${bp}ï¼Œ${temp}ã€‚ä»Šæ—¥ä»»å‹™ï¼š${tasks}ã€‚åŠ æ²¹ï¼`;
    speak(msg);
  }

  // è¼‰å…¥èªéŸ³æ¸…å–®ï¼ˆæœ‰äº›ç€è¦½å™¨éœ€è¦ï¼‰
  if ('speechSynthesis' in window) {
    speechSynthesis.onvoiceschanged = () => { pickZhTWVoice(); };
  }
  </script>
  
</body>
</html>
