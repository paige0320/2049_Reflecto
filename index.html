<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eterna Mirror · 單張早安圖（JS 陣列，不用 fetch）</title>
<style>
  html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; color:#fff;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans","PingFang TC","Microsoft JhengHei",sans-serif; }
  #videoBg { position:fixed; inset:0; width:100%; height:100%; object-fit:cover; transform: scaleX(-1); z-index:0; background:#000; }
  header { position: fixed; top:0; left:0; right:0; z-index:2; text-align:center; padding:1.2vh 2vw 2vh;
    background: linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,0)); pointer-events:none; }
  h1 { font-size: clamp(26px, 5.5vw, 56px); margin:.2em 0; text-shadow: 0 2px 18px rgba(0,0,0,.45); }
  .sub { opacity:.9; font-size: clamp(12px, 2.5vw, 16px); }
  .time { font-size: clamp(18px, 4vw, 36px); font-variant-numeric: tabular-nums; margin-top:.2em; }
  .side { position: fixed; top: 14vh; bottom: 6vh; width: 22vw; z-index:2;
    display:flex; flex-direction:column; gap: 1.2vh; padding: 0 1vw; pointer-events: none; }
  .left { left: 0; align-items: flex-start; }
  .right { right: 0; align-items: flex-end; }
  .card { width: 100%; max-width: 360px; pointer-events:auto; background: rgba(0,0,0,.45);
    border:1px solid rgba(255,255,255,.18); border-radius: 14px; padding: .8em 1em; backdrop-filter: blur(8px); }
  .title { font-size: clamp(16px,3.6vw,22px); opacity:.95; margin:0 0 .1em; }
  .val { font-size: clamp(16px,3.8vw,24px); font-variant-numeric: tabular-nums; opacity:.95; }
  .note { font-size: clamp(12px,2.6vw,16px); opacity:.8; }
  .tasks li { margin: .2em 0; font-size: clamp(14px,3.6vw,18px); opacity:.95; }
  .gm-card { flex:1; display:flex; }
  #gmWrap { display:flex; align-items:center; justify-content:center; width:100%; border-radius:14px;
    background: rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); padding:.4em; }
  #gmWrap img { max-width:100%; max-height:100%; border-radius:12px; object-fit:contain; }
  .floating { position: fixed; right: 2vw; bottom: 8vh; z-index:2; display:flex; gap:.6em; }
  .btn { background: rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.25); border-radius:12px; padding:.55em .85em; backdrop-filter: blur(8px); font-size: clamp(12px,2.8vw,14px); }
  @media (max-width: 1024px){ .side { width: 28vw; gap: 1vh; } }
  @media (max-width: 768px){ header { padding: .8vh 2vw 1.2vh; } .side { width: 34vw; top: 12vh; bottom: 8vh; } .title { font-size: clamp(14px,4vw,18px); } .val { font-size: clamp(14px,4.4vw,20px); } }
</style>
</head>
<body>
  <video id="videoBg" autoplay playsinline muted></video>
  <header>
    <h1>早安，今天也一起加油</h1>
    <div class="sub" id="date"></div>
    <div class="time" id="time"></div>
  </header>

  <!-- 左側：服藥提醒 / 親友問候 / 早安圖 -->
  <section class="side left">
    <div class="card">
      <div class="title">服藥提醒</div>
      <div class="val">早上 A 藥 1 顆</div>
      <div class="note">09:00 記得服用</div>
    </div>
    <div class="card">
      <div class="title">親友問候</div>
      <div class="val">孫女：早安阿公 ❤️</div>
    </div>
    <div class="gm-card">
      <div id="gmWrap">
        <img id="gmImg" src="" alt="早安圖">
      </div>
    </div>
  </section>

  <!-- 右側：心跳（置頂） / 血壓（含體溫副標） / 今日任務 -->
  <section class="side right">
    <div class="card">
      <div class="title">心跳</div>
      <div class="val">72 bpm</div>
    </div>
    <div class="card">
      <div class="title">血壓</div>
      <div class="val">125 / 78</div>
      <div class="note">體溫 36.6 °C</div>
    </div>
    <div class="card">
      <div class="title">今日任務</div>
      <ul id="taskList" class="tasks">
        <li>• 去醫院復健（10:00）</li>
        <li>• 圖書館書到期（今天或線上續借）</li>
        <li>• 測一次血壓</li>
      </ul>
    </div>
  </section>

  <div class="floating">
    <button class="btn" onclick="speakToday()">🔊 語音播報</button>
    <button class="btn" onclick="flipCam()">🔁 切換鏡頭</button>
    <button class="btn" onclick="switchTorch()">🔦 輔助燈</button>
  </div>

  <script>
    // 時間
    function pad(n){return n<10? '0'+n : n}
    function tick(){
      const now = new Date();
      document.getElementById('date').textContent =
        now.toLocaleDateString('zh-TW',{year:'numeric',month:'long',day:'numeric',weekday:'long'});
      document.getElementById('time').textContent = pad(now.getHours()) + ':' + pad(now.getMinutes());
    }
    setInterval(tick, 1000); tick();

    // 任務：固定兩項 + 每日再抽 1 項
    const fixedTasks = ['去醫院復健（10:00）','圖書館書到期（今天或線上續借）'];
    const pool = ['喝水 6 杯','伸展 10 分鐘','看看昨天的照片 / 留言','去社區中庭走走 5 分鐘','水果一份（香蕉/蘋果）','打電話給朋友問候 5 分鐘'];
    function pickTasks(){
      const seed = new Date().toDateString();
      let rnd = [...seed].reduce((a,c)=>a+c.charCodeAt(0),0);
      function rand(){ rnd = (rnd*9301 + 49297) % 233280; return rnd/233280; }
      const copy = pool.slice();
      const i = Math.floor(rand()*copy.length);
      const selected = copy.splice(i,1);
      document.getElementById('taskList').innerHTML = ['• '+fixedTasks[0],'• '+fixedTasks[1],'• '+selected[0]].map(t=>'<li>'+t+'</li>').join('');
    }
    pickTasks();

    // 早安圖：JS 陣列（不用 fetch），每次開啟隨機一張
    const gmImages = [
      "images/goodmorning/1.jpg",
      "images/goodmorning/2.jpg",
      "images/goodmorning/3.jpg",
      "images/goodmorning/4.jpg",
      "images/goodmorning/5.jpg",
      "images/goodmorning/6.jpg",
      "images/goodmorning/7.jpg",
      "images/goodmorning/8.jpg",
      "images/goodmorning/9.jpg"
      // 之後新增圖片時，把檔名加在這裡，例如：
      // ,"images/goodmorning/02.jpg","images/goodmorning/03.jpg"
    ];
    (function showRandomGM(){
      const idx = Math.floor(Math.random()*gmImages.length);
      document.getElementById('gmImg').src = gmImages[idx];
    })();

    // 相機
    let currentFacing = 'user', currentStream = null, trackForTorch = null;
    async function startCamera(){
      stopCamera();
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: currentFacing, width: { ideal: 1280 }, height: { ideal: 720 } },
          audio: false
        });
        currentStream = stream;
        const video = document.getElementById('videoBg');
        video.srcObject = stream;
        const [track] = stream.getVideoTracks();
        trackForTorch = track;
      } catch (e) { alert('無法開啟相機：' + e.message); }
    }
    function stopCamera(){ if (currentStream){ currentStream.getTracks().forEach(t=>t.stop()); currentStream=null; } trackForTorch=null; }
    async function flipCam(){ currentFacing = (currentFacing === 'user') ? 'environment' : 'user'; await startCamera(); }
    async function switchTorch(){
      try {
        if (!trackForTorch) return alert('裝置不支援或尚未啟用相機');
        const capabilities = trackForTorch.getCapabilities?.();
        if (capabilities && 'torch' in capabilities) {
          const settings = trackForTorch.getSettings();
          await trackForTorch.applyConstraints({ advanced: [{ torch: !settings.torch }] });
        } else { alert('此瀏覽器不支援手電筒控制'); }
      } catch (e) { alert('切換輔助燈失敗：' + e.message); }
    }
    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia){ startCamera(); } else { alert('此瀏覽器不支援相機存取'); }
    window.addEventListener('beforeunload', stopCamera);
    
  // 嘗試挑選中文（台灣優先）
  function pickZhTWVoice() {
    const vs = speechSynthesis.getVoices();
    return vs.find(v => /zh(-|_)TW/i.test(v.lang))
        || vs.find(v => /zh/i.test(v.lang))
        || vs[0];
  }

  function speak(text) {
    if (!('speechSynthesis' in window)) { 
      alert('此瀏覽器不支援語音播報'); 
      return; 
    }
    const u = new SpeechSynthesisUtterance(text);
    u.rate = 1; u.pitch = 1; u.volume = 1;
    const v = pickZhTWVoice(); 
    if (v) u.voice = v;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }

  // 蒐集頁面資訊並播報
  function speakToday(){
    const date = document.getElementById('date')?.textContent || '';
    const heart = (document.getElementById('heartRate')?.textContent) || '心跳七十二';
    const bp    = (document.getElementById('bloodPressure')?.textContent) || '血壓一二五比七八';
    const temp  = (document.getElementById('temperature')?.textContent) || '體溫三十六點六度';
    const tasks = [...document.querySelectorAll('#taskList li')].map(li=>li.textContent.replace(/^•\s*/,'')).join('；');
    const msg = `早安！今天是 ${date}。${heart}，${bp}，${temp}。今日任務：${tasks}。加油！`;
    speak(msg);
  }

  // 載入語音清單（有些瀏覽器需要）
  if ('speechSynthesis' in window) {
    speechSynthesis.onvoiceschanged = () => { pickZhTWVoice(); };
  }
  </script>
  
</body>
</html>
